<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>RailRoad: Process the Frames of an iOS device Camera in realtime quickly and easily</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="649902307769702426.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">RailRoad
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Process the Frames of an iOS device Camera in realtime quickly and easily </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Stuart Lynch <a href="#" onclick="location.href='mai'+'lto:'+'stu'+'ar'+'t.l'+'yn'+'ch@'+'ue'+'a.a'+'c.'+'uk'; return false;">stuar<span style="display: none;">.nosp@m.</span>t.ly<span style="display: none;">.nosp@m.</span>nch@u<span style="display: none;">.nosp@m.</span>ea.a<span style="display: none;">.nosp@m.</span>c.uk</a></dd></dl>
<p>This is a completely Open Source project that provides a simple framework to process the live camera frames of an iOS device. It is distributed under the GNU General Public License. I developed this because I wanted an easy way to code image processing algorithms on a mobile device. OpenGL ES 2 can be quite complex to set up and use, so this project aims to simplify the setup, and target it for a specific single texture application.</p>
<p>The flow of processing is:</p>
<ol type="1">
<li>Retrieve a UIImage of the frame (a UIImage is a class developed by Apple to represent a stored image).</li>
<li>Get the bytes that make up the image and do any global processing on the CPU.</li>
<li>Take any output from the CPU processing and send to the GPU for super fast pixel-by-pixel processing.</li>
<li>Display the frame.</li>
</ol>
<h2>Setup</h2>
<p>If you are familar with iOS and Cocoa then you can embed this in your own project. Simply add an instance of <a class="el" href="interface_r_r_camera_view.html" title="A class to handle the displaying of the processed camera frames.">RRCameraView</a> and embed it where you like in your interface. Follow the instructions for further setup below.</p>
<p>If you are not familar with iOS then you can still used this project. The main class of interest to you is RRMainViewController. You can develop your own algorithm just by adding your own code here. RRMainViewController is already setup with initalization code, but the following documentation (for tutorial purposes) will talk you through the initalization as if it wasn't.</p>
<p>In the <code>viewDidLoad</code> method, the first thing to do is intialize a new instance of <a class="el" href="interface_r_r_camera_view.html" title="A class to handle the displaying of the processed camera frames.">RRCameraView</a>.</p>
<p><code>_cameraView = [[<a class="el" href="interface_r_r_camera_view.html" title="A class to handle the displaying of the processed camera frames.">RRCameraView</a> alloc] initWithFrame:CGRectMake(0, 0, self.view.frame.size.width,self.view.frame.size.height)];</code></p>
<p>We want to recieve the delegate methods from the <a class="el" href="interface_r_r_camera_capture_session.html" title="A class to deal with the frames captured from the camera.">RRCameraCaptureSession</a> in the <a class="el" href="interface_r_r_camera_view.html" title="A class to handle the displaying of the processed camera frames.">RRCameraView</a>. So we set our class (RRMainViewController) to implement the <code>&lt;<a class="el" href="protocol_r_r_camera_capture_session_delegate-p.html" title="A protocol which contains one method for accessing the captured frames.">RRCameraCaptureSessionDelegate</a>&gt;</code>. Then add this code below the initialization of <code>_cameraView</code>:</p>
<p><code>_cameraView.cameraCaptureSession.delegate = self;</code></p>
<p>We then want to initalize OpenGL on the view. We pass in the name of a fragment shader. This is a file in the bundle which has a suffix '.glsl' and contains the code for the pixel-by-pixel processing on the GPU. If we don't want to do any processing we can pass in 'DoNothing' which is a shader that does no processing, it simply just displays the pixels. For this tutorial we will pass in the 'Brightness' shader.</p>
<p><code>[_cameraView intializeOpenGLWithShader:@"Brightness"];</code></p>
<p>The brightness shader simply scales the pixel by a given amount. We have to provide it with the scaler that we want to change the brightness to. We can pass in a Uniform Variable to the shader, which is a variable that will remain constant for all of the pixels of that image. The Brightness shader contains a variable <code>BrightnessValue</code>. So we will we define this using the following code:</p>
<p><code>[_cameraView.openGL initShaderUniform:@"BrightnessValue" ofDataType:GLSL_DATA_TYPE_FLOAT];</code></p>
<p>The method above defines the shader uniform variable and defines it's datatype. In this case it is a float. We can then set the value of this variable by calling the following code:</p>
<p><code>GLfloat brightnessValue = 0.5f; </code>[_cameraView.openGL shaderUniform:"BrightnessValue" setValue:&amp;brightnessValue];`</p>
<p>We have to provide a pointer to the data as the value. This is because the value could be one of several datatypes, including an array. We now want to implement the delegate method. Create a new method:</p>
<p><code>- (void)cameraCaptureSession:(RRCameraCaptureSession *)session capturedImage:(UIImage *)image</code></p>
<p>In this method we want to send the UIImage to the GPU using OpenGL. We can do this by calling the following method on the OpenGL instance contained in the <a class="el" href="interface_r_r_camera_view.html" title="A class to handle the displaying of the processed camera frames.">RRCameraView</a>:</p>
<p><code>[_cameraView.openGL setupTextureWithImage:image processImageBytesBlock:nil];</code></p>
<p>For the moment we won't do any processing on the CPU of the image. We will just send it straight to the GPU for display, therefore we set the <code>processImageBytesBlock</code> argument to <code>nil</code>. Finally we render the image by calling this function directly after:</p>
<p><code>[_cameraView.openGL render];</code></p>
<p>If you run the code, you will see the camera frames displayed at 50% brightness. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 11 2013 23:23:11 for RailRoad by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
